

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>doekbase.data_api.wsfile &mdash; KBase Data API 0.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/kbase-logo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/css/bootstrap.min.css" type="text/css" />
  

  
    <link rel="top" title="KBase Data API 0.1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> KBase Data API
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javascript.html">JavaScript API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">KBase Data API</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>doekbase.data_api.wsfile</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for doekbase.data_api.wsfile</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Workspace implemented over files, using the mongomock package.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Dan Gunter &lt;dkgunter@lbl.gov&gt;&#39;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s1">&#39;9/3/15&#39;</span>

<span class="c1"># Imports</span>

<span class="c1"># Stdlib</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cStringIO</span> <span class="kn">as</span> <span class="nn">StringIO</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">msgpack</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># Third-party</span>
<span class="kn">import</span> <span class="nn">mongomock</span> <span class="kn">as</span> <span class="nn">mm</span>
<span class="c1"># Local</span>
<span class="kn">from</span> <span class="nn">doekbase.data_api.util</span> <span class="kn">import</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">log_start</span><span class="p">,</span> <span class="n">log_end</span>
<span class="kn">from</span> <span class="nn">doekbase.workspace.client</span> <span class="kn">import</span> <span class="n">ServerError</span>

<span class="c1"># Logging</span>

<span class="n">_log</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1"># Globals</span>

<span class="n">NUMERIC_REF_PAT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\d+/\d+(/\d+)?&#39;</span><span class="p">)</span>

<span class="c1"># Exceptions</span>

<div class="viewcode-block" id="LibError"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.LibError">[docs]</a><span class="k">class</span> <span class="nc">LibError</span><span class="p">(</span><span class="n">ServerError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To imitate server errors, raise this with a description</span>
<span class="sd">    of the error as the argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LibError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s1">&#39;ServerError&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">32500</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span></div>

<span class="c1"># Functions and classes</span>

<span class="n">ws_url_template</span> <span class="o">=</span> <span class="s1">&#39;https://{}.kbase.us/services/ws/&#39;</span>

<div class="viewcode-block" id="workspace_to_file"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.workspace_to_file">[docs]</a><span class="k">def</span> <span class="nf">workspace_to_file</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">workspace</span><span class="o">=</span><span class="s1">&#39;narrative&#39;</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert Workspace objects to the JSON format read by the</span>
<span class="sd">    mongomock module.</span>

<span class="sd">    Args:</span>
<span class="sd">      ref (str): Workspace object reference e.g. &#39;1019/4/1&#39;</span>
<span class="sd">      workspace (str): Name or full URL for workspace to contact; &#39;narrative&#39;</span>
<span class="sd">        or &#39;ci&#39; are recognized</span>
<span class="sd">      token (str): KBase auth token</span>

<span class="sd">    Return:</span>
<span class="sd">       (dict) Object in the mock schema</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">doekbase.workspace.client</span> <span class="kn">import</span> <span class="n">Workspace</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;https://.*&#39;</span><span class="p">,</span> <span class="n">workspace</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">workspace</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">ws_url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workspace</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;KB_AUTH_TOKEN&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No `token` given and environment does not &#39;</span>
                             <span class="s1">&#39;contain value for KB_AUTH_TOKEN&#39;</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>
    <span class="n">objlist</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">get_objects</span><span class="p">([{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="n">ref</span><span class="p">}])</span>
    <span class="n">obj</span><span class="p">,</span> <span class="n">oi</span> <span class="o">=</span> <span class="n">objlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">objlist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
    <span class="n">canonical_ref</span> <span class="o">=</span> <span class="s2">&quot;{0}/{1}/{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oi</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">oi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oi</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">canonical_name</span> <span class="o">=</span> <span class="s2">&quot;{0}/{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oi</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># convert to our schema</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ref&#39;</span><span class="p">:</span> <span class="n">canonical_ref</span><span class="p">,</span>
         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">oi</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">canonical_name</span><span class="p">,</span>
         <span class="s1">&#39;links&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;refs&#39;</span><span class="p">],</span>
         <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
         <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">oi</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
         <span class="p">}</span>
    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;workspace_to_file: returning record for: {}&#39;</span>
               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">canonical_ref</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="WorkspaceFile"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile">[docs]</a><span class="k">class</span> <span class="nc">WorkspaceFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mock object for KBase Workspace service.</span>

<span class="sd">    You can use this in place of the doekbase.client.workspace.Workspace class.</span>

<span class="sd">    To insulate from changes in the workspace storage format, the input</span>
<span class="sd">    data is in a simplified and reduced schema. The input should be a list</span>
<span class="sd">    of JSON ojects, separated by commas and bracketed by &quot;[ ]&quot; like a</span>
<span class="sd">    normal JSON list. Each object should have these fields:</span>

<span class="sd">    * ref - object reference like &quot;123/4&quot;</span>
<span class="sd">    * type - Name of the type of this object, e.g. &quot;FooType&quot;</span>
<span class="sd">    * name - Name of this object, e.g. &quot;ReferenceGenomeAnnotations/kb|g.3157&quot;</span>
<span class="sd">    * links - List of references, each in the same form as the &#39;ref&#39; field.</span>
<span class="sd">    * data - JSON object with the data (whatever you want)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Use MessagePack encoding for workspace objects</span>
    <span class="n">use_msgpack</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">use_redis</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_loaded</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># static cache of loaded refs</span>

    <span class="c1">#: Version of the workspace we are emulating</span>
    <span class="n">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.3.5&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create file-based Workspace instance, using files in</span>
<span class="sd">        the given working directory.</span>

<span class="sd">        Additional files are added with the `load` method.</span>

<span class="sd">        Args:</span>
<span class="sd">          working_directory (str): Path to directory with files to load.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wd</span> <span class="o">=</span> <span class="n">working_directory</span>
        <span class="c1"># create client and collection</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">collection</span>
        <span class="c1"># This monkey-patch avoids a copy of the parsed workspace object</span>
        <span class="c1"># as it is added to the mongomock collection. Of course, this</span>
        <span class="c1"># means that this dict MUST be treated as immutable by other code.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">_internalize_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span>
        <span class="c1"># some internal state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oids</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="WorkspaceFile.load"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load data from a given reference.</span>

<span class="sd">        The reference will be translated into a file to load,</span>
<span class="sd">        using the following formula:</span>
<span class="sd">        ``&lt;working_directory&gt; + &#39;/&#39; + &lt;ref&gt; + &lt;ext&gt;`,</span>
<span class="sd">        where ``&lt;working_directory&gt;`` is the path given to the class</span>
<span class="sd">        constructor, ``&lt;ref&gt;`` is the reference given to this</span>
<span class="sd">        function, and</span>
<span class="sd">        ``&lt;ext&gt;`` is a file extension &#39;.msgpack&#39; if</span>
<span class="sd">        `use_msgpack` is True and &#39;.json&#39; otherwise.</span>

<span class="sd">        Thus, for ``WorkspaceFile(&#39;/tmp/data&#39;).load(&#39;foo_bar&#39;)``,</span>
<span class="sd">        the path loaded would be &#39;/tmp/data/foo_bar.msgpack&#39;.</span>

<span class="sd">        See class documentation on format of input data.</span>

<span class="sd">        Args:</span>
<span class="sd">          ref (str): The reference</span>

<span class="sd">        Notes:</span>
<span class="sd">          * Post-condition: Object is loaded if and only if that reference was</span>
<span class="sd">            not loaded previously. Modification timestamp of the underlying</span>
<span class="sd">            file is NOT checked, you must manually invalidate modified</span>
<span class="sd">            data with :meth:`unload(ref)`.</span>

<span class="sd">        Raises:</span>
<span class="sd">          IOError: file not found or not readable.</span>
<span class="sd">          ValueError: parsing failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># log start</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">log_start</span><span class="p">(</span><span class="n">_log</span><span class="p">,</span> <span class="s1">&#39;WorkspaceFile.load&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                       <span class="n">kvp</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">))</span>
        <span class="c1"># stop if already loaded in the past</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">:</span>
            <span class="c1"># log done and return</span>
            <span class="n">log_end</span><span class="p">(</span><span class="n">_log</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="s1">&#39;WorkspaceFile.load&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                    <span class="n">kvp</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="c1"># create the full path from the reference</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;msgpack&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_msgpack</span> <span class="k">else</span> <span class="s1">&#39;json&#39;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="s1">&#39;{}.{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wd</span><span class="p">,</span> <span class="n">ref</span><span class="p">),</span> <span class="n">ext</span><span class="p">)</span>
        <span class="c1"># open the file; raises IOError on failure</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
        <span class="c1"># parse the file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_msgpack</span> <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Loading {}: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># cache the parsed data, both by reference and by &#39;name&#39;</span>
        <span class="c1"># (if name is not the same as reference)</span>
        <span class="c1">#print(&quot;@@ REF={r} RECORD[ref]={rr} RECORD[name]={n}&quot;</span>
        <span class="c1">#      .format(r=ref, rr=record[&#39;ref&#39;], n=record[&#39;name&#39;]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span>
        <span class="c1">#print(&#39;@@ STORE RECORD BY ({},{})&#39;.format(record[&#39;ref&#39;], record[&#39;name&#39;]))</span>
        <span class="c1"># insert the parsed data into mongomock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="c1"># log done</span>
        <span class="n">log_end</span><span class="p">(</span><span class="n">_log</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="s1">&#39;WorkspaceFile.load&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                <span class="n">kvp</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="WorkspaceFile.unload"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.unload">[docs]</a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force reload of ``ref`` the next time.</span>
<span class="sd">        Does nothing if ``ref`` is not already loaded.</span>

<span class="sd">        Args:</span>
<span class="sd">          ref (str): The reference</span>
<span class="sd">        Post:</span>
<span class="sd">           ref is no longer loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span></div>

    <span class="c1"># Public methods</span>

<div class="viewcode-block" id="WorkspaceFile.copy_object"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.copy_object">[docs]</a>    <span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="c1"># do nothing</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_object_history"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_object_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_object_info_new"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_object_info_new">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_info_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;objects&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_info_tuple</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">])</span>
                  <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_object_provenance"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_object_provenance">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_provenance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_object_subset"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_object_subset">[docs]</a>    <span class="k">def</span> <span class="nf">get_object_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Note: this is not efficient. It actually looks at</span>
<span class="sd">        the whole object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># loop over each specified subset, and add all results</span>
        <span class="c1"># to a single list in `result`</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">prm</span><span class="p">:</span>
            <span class="n">ref</span><span class="p">,</span> <span class="n">paths</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">],</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]</span>
            <span class="c1"># get matching records and data in the paths</span>
            <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="c1"># add to result</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
                <span class="n">extracted</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># all extracted paths</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="c1"># alias</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

                    <span class="c1"># Look for value matching path in &#39;d&#39;</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">extracted</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

                            <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                                <span class="n">e</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">):</span>
                                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                            <span class="n">e</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

                    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print(&quot;@@ add extracted: {}&quot;.format(extracted))</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_object</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">extracted</span><span class="p">)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_objects"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_objects">[docs]</a>    <span class="k">def</span> <span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">prm</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
            <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
            <span class="c1">#print(&quot;@@ GO, got records: {}&quot;.format(records))</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_object</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_type_info"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_type_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_type_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_type_info</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_name</span><span class="p">})</span></div>

<div class="viewcode-block" id="WorkspaceFile.list_referencing_objects"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.list_referencing_objects">[docs]</a>    <span class="k">def</span> <span class="nf">list_referencing_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prm</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">refs</span> <span class="ow">in</span> <span class="n">prm</span><span class="p">:</span>
            <span class="n">ref_result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
            <span class="c1"># find every record that refers to this one</span>
            <span class="k">for</span> <span class="n">rfr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;links&#39;</span><span class="p">:</span> <span class="n">ref</span><span class="p">}):</span>
                <span class="n">info_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_info_tuple</span><span class="p">(</span><span class="n">rfr</span><span class="p">,</span> <span class="n">rfr</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">])</span>
                <span class="n">ref_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info_tuple</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="WorkspaceFile.translate_to_MD5_types"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.translate_to_MD5_types">[docs]</a>    <span class="k">def</span> <span class="nf">translate_to_MD5_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">MD5_TYPES</span><span class="p">:</span>
                <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">MD5_TYPES</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LibError</span><span class="p">(</span><span class="s1">&#39;Type schema record was not found for {}&#39;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="WorkspaceFile.ver"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.ver">[docs]</a>    <span class="k">def</span> <span class="nf">ver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION</span></div>

<div class="viewcode-block" id="WorkspaceFile.get_children"><a class="viewcode-back" href="../../../_source/doekbase.data_api.html#doekbase.data_api.wsfile.WorkspaceFile.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span></div>

    <span class="c1"># ___ Internal methods ___</span>

    <span class="k">def</span> <span class="nf">_get_oid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oids</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
        <span class="n">new_oid</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oids</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">ref</span><span class="p">)))</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oids</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_oid</span>
        <span class="k">return</span> <span class="n">new_oid</span>

    <span class="k">def</span> <span class="nf">_make_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make and return a single &#39;info&#39; section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">NUMERIC_REF_PAT</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>  <span class="c1"># require numeric ref</span>
        <span class="c1">#print(&quot;@@ make_info from: {}&quot;.format(record))</span>
        <span class="n">ws_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">oid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_oid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;object_id&#39;</span><span class="p">:</span> <span class="n">oid</span><span class="p">,</span>
                <span class="s1">&#39;object_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object{:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oid</span><span class="p">),</span>
                <span class="s1">&#39;object_reference&#39;</span><span class="p">:</span> <span class="n">ref</span><span class="p">,</span>
                <span class="s1">&#39;object_reference_versioned&#39;</span><span class="p">:</span> <span class="s1">&#39;{}/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>
                <span class="s1">&#39;type_string&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
                <span class="s1">&#39;save_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
                <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;saved_by&#39;</span><span class="p">:</span> <span class="s1">&#39;CookieMonster&#39;</span><span class="p">,</span>
                <span class="s1">&#39;workspace_id&#39;</span><span class="p">:</span> <span class="n">ws_id</span><span class="p">,</span>
                <span class="s1">&#39;workspace_name&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;object_checksum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;object_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="s1">&#39;object_metadata&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">_make_info_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make the object_info type tuple:</span>

<span class="sd">        0: obj_id objid, 1: obj_name name,</span>
<span class="sd">        2: type_string type, 3: timestamp save_date,</span>
<span class="sd">        4: int version, 5: username saved_by,</span>
<span class="sd">		6: ws_id wsid, 7: ws_name workspace,</span>
<span class="sd">		8: string chsum, 9: int size, 10: usermeta meta</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">NUMERIC_REF_PAT</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>  <span class="c1"># require numeric ref</span>
        <span class="n">wsid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_oid</span><span class="p">(</span><span class="n">ref</span><span class="p">),</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">record</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
                <span class="n">ver</span><span class="p">,</span> <span class="s1">&#39;joe&#39;</span><span class="p">,</span>
                <span class="n">wsid</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{}</span>
                <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_make_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">canonical_ref</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
            <span class="s1">&#39;object_info&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_info</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">canonical_ref</span><span class="p">),</span>
            <span class="s1">&#39;provenance&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;creator&#39;</span><span class="p">:</span> <span class="s1">&#39;Gonzo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
            <span class="s1">&#39;refs&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;copied&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;copy_source_inaccessible&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;extracted_ids&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;handle_error&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;handle_stacktrace&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_make_type_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;type_string&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;This is type {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]),</span>
            <span class="c1"># &#39;spec_def&#39;: &#39;&#39;,</span>
            <span class="c1"># &#39;json_schema&#39;: &#39;{}&#39;,</span>
            <span class="c1"># &#39;parsing_structure&#39;: &#39;{}&#39;,</span>
            <span class="c1"># &#39;module_vers&#39;: [1],</span>
            <span class="c1"># &#39;released_module_vers&#39;: [1],</span>
            <span class="c1"># &#39;type_vers&#39; : [&#39;1&#39;],</span>
            <span class="c1"># &#39;released_type_vers&#39;: [&#39;1&#39;],</span>
            <span class="c1"># &#39;using_func_defs&#39;: [],</span>
            <span class="c1"># &#39;using_type_defs&#39;: [],</span>
            <span class="c1"># &#39;used_type_defs&#39;: []</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_find_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find records by reference.</span>

<span class="sd">        Args:</span>
<span class="sd">          ref (str): numeric or named object reference</span>
<span class="sd">        Returns:</span>
<span class="sd">          list of records (may be an empty list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print(&quot;@@ looking for REF={} in KEYS={}&quot;.format(ref, self._loaded.keys()))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded</span><span class="p">[</span><span class="n">ref</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span></div>

<span class="c1">####</span>

<span class="n">MD5_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-1e1fce431960397da77cb092d27a50cf&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-1e1fce431960397da77cb092d27a50cf&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-2.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-e0979de9df4baccca8bdd95f7565fde4&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-3.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-225de07e59f4fdc5d9b8bf0bcd12c498&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-4.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-c0526fae0ce1fd8d342ec94fc4dc510a&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-5.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-c0526fae0ce1fd8d342ec94fc4dc510a&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-6.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-aafaaa7df90d03b33258f4fa7790dcbe&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-7.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-93da9d2c8fb7836fb473dd9c1e4ca89e&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.Genome-8.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.Genome-51b05a5c27084ae56106e60df5b66df5&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomes.ContigSet-3.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomes.ContigSet-db7f518c9469d166a783d813c15d64e9&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.AnnotationQuality-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.AnnotationQuality-477a5cc8e4eef9a07eddea445d5b3e03&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.AnnotationQuality-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.AnnotationQuality-477a5cc8e4eef9a07eddea445d5b3e03&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.Assembly-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.Assembly-5702392af48de51769471473571ffb1a&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.Assembly-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.Assembly-5702392af48de51769471473571ffb1a&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.EvidenceContainer-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.EvidenceContainer-ffd466ca300b0c9479a2eee1aa4d53be&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.EvidenceContainer-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.EvidenceContainer-ffd466ca300b0c9479a2eee1aa4d53be&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.FeatureContainer-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.FeatureContainer-77ee3036a791592496e3852b3c9e87b4&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.FeatureContainer-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.FeatureContainer-77ee3036a791592496e3852b3c9e87b4&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-994bc5d281b14ae29d2759bce9d59703&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-0.2&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-34168943eac1c2fd0746655790a63afe&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotation-34168943eac1c2fd0746655790a63afe&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotationSet-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotationSet-a1c6a7e69da3d38e403b8bac4e312a23&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotationSet-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.GenomeAnnotationSet-a1c6a7e69da3d38e403b8bac4e312a23&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.ProteinContainer-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.ProteinContainer-24986e79a34d6c0800b2008c974015b4&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.ProteinContainer-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.ProteinContainer-24986e79a34d6c0800b2008c974015b4&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.SeedRoles-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.SeedRoles-4633e4a9703e27c7b6e6760c8ec5f893&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.SeedRoles-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.SeedRoles-4633e4a9703e27c7b6e6760c8ec5f893&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.Taxon-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.Taxon-6367e669a33764f466bb0c71628e3b22&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.Taxon-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.Taxon-6367e669a33764f466bb0c71628e3b22&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-c5ce71324217b089cb8a17eda359a8f6&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-c5ce71324217b089cb8a17eda359a8f6&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-2.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonLookup-75222de8c337d6d4f53943cd1e5a59aa&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonSet-0.1&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonSet-e4b647bbc4d7965a8def8909b10c6b9e&#39;</span><span class="p">,</span>
    <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonSet-1.0&#39;</span><span class="p">:</span> <span class="s1">u&#39;KBaseGenomeAnnotations.TaxonSet-e4b647bbc4d7965a8def8909b10c6b9e&#39;</span>
<span class="p">}</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 The KBase Project.
      Last updated on Mar 20, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
<div class="container-fluid kbase-footer">
    <div class="row">
        <div class="col-md-12">
            <div class="footer-bar">
                <div class="kbase-footer-menu">
                    <ul id="menu-footer-menu" class="menu">
                        <li id="menu-item-664"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-664">
                            <a href="http://kbase.us/what-is-kbase/">About
                                KBase</a> <span class="footer-sep"></span></li>
                        <li id="menu-item-666"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-666">
                            <a href="http://kbase.us/terms-and-conditions/">Terms
                                and Conditions</a> <span
                                class="footer-sep"></span></li>
                        <li id="menu-item-667"
                            class="menu-item menu-item-type-post_type menu-item-object-page menu-item-667">
                            <a href="http://kbase.us/contact-us/">Contact Us</a>
                            <span class="footer-sep"></span></li>
                    </ul>
                </div>
                <!-- hard code the social icons for now -->
                <a href="https://www.facebook.com/pages/DOE-Systems-Biology-Knowledgebase/148332628600806"
                   target="_blank" style="height: 24px; display: inline-block;"
                   class="menu-item"><img
                        src="http://kbase.us/wp-content/themes/kbase-wordpress-theme/images/facebook-icon.png"></a>

                <span class="footer-sep"></span>

                <a href="https://twitter.com/DOEKbase" target="_blank"><img
                        src="http://kbase.us/wp-content/themes/kbase-wordpress-theme/images/twitter-icon.png"></a>

                <span class="footer-sep"></span>

                <a href="http://science.energy.gov/ber/">
                    <img src="_static/img/doe_office_of_science_250.png"
                         alt="doe_office_of_science_250.png" width="250"
                         height="42" target="_blank">
                </a>

            </div>
        </div>
    </div>
</div>
<jinja2.runtime.BlockReference object at 0x110e1ea10>


</body>
</html>